/* ==========================================================
 * leafpile.js v0.1.1
 * A marker clustering layer for Leaflet maps
 * http://github.com/cavis/leafpile
 * ==========================================================
 * Copyright (c) 2012 Ryan Cavis
 * Licensed under http://en.wikipedia.org/wiki/MIT_License
 * ========================================================== */
L.Leafpile=L.Class.extend({includes:L.Mixin.Events,options:{radius:60,maxZoomChange:2,maxZoomLevel:8,autoEnable:true,singlePiles:false},addMarker:function(b){var a=L.Util.stamp(b);this._markers[a]=b;if(!this._map){return this}if(this._enabled){this._pileMarker(b)}else{this._map.addLayer(b)}return this},addLayer:function(a){if(a instanceof L.Marker){return this.addMarker(a)}throw new Error("Sorry, but L.Leafpile can only hold markers right now.")},getMarkers:function(){var b=[];for(var a in this._markers){b.push(this._markers[a])}return b},removeMarker:function(c){var b=L.Util.stamp(c);delete this._markers[b];if(!this._map){return this}if(this._enabled){for(var a in this._leafpiles){if(this._leafpiles[a].hasMarker(c)){this._leafpiles[a].removeMarker(c)}}}else{this._map.removeLayer(c)}return this},removeLayer:function(a){if(a instanceof L.Marker){return this.removeMarker(a)}throw new Error("Sorry, but L.Leafpile can only hold markers right now.")},setRadius:function(a){if(a==0){return this.disable()}this.options.radius=a;if(!this._map){return this}if(this._map.getZoom()>this.options.maxZoomLevel){return false}if(this._enabled){this._iteratePiles(this._map.removeLayer,this._map);this._iterateMarkers(this._map.removeLayer,this._map);this._leafpiles={}}else{this._iterateMarkers(this._map.removeLayer,this._map)}this._iterateMarkers(this._pileMarker,this);this._enabled=true;return this},clear:function(){this._iteratePiles(this._map.removeLayer,this._map);this._iterateMarkers(this._map.removeLayer,this._map);this._leafpiles={};this._markers={};return this},enable:function(){if(!this._enabled){this._enabled=true;if(!this._map){return this}if(this._map.getZoom()>this.options.maxZoomLevel){return false}this._zoomDisabledMe=false;this._iterateMarkers(this._map.removeLayer,this._map);this._iterateMarkers(this._pileMarker,this)}return this},disable:function(){if(this._enabled){this._enabled=false;this._zoomDisabledMe=false;if(!this._map){return this}this._iteratePiles(this._map.removeLayer,this._map);this._leafpiles={};this._iterateMarkers(this._map.addLayer,this._map)}return true},initialize:function(a){L.Util.setOptions(this,a);this._markers={};this._leafpiles={};this._enabled=this.options.autoEnable},onAdd:function(a){this._map=a;this._map.on("zoomend",this._onZoomEnd,this);if(a.getZoom()>this.options.maxZoomLevel){this._enabled=false;this._zoomDisabledMe=true}this._iterateMarkers(this.addMarker,this);return this},onRemove:function(a){this.clear();this._map.off("zoomend",this._onZoomEnd,this);this._map=null},_onZoomEnd:function(b){var a=this._map.getZoom();if(this._enabled&&a>this.options.maxZoomLevel){this.disable();this._zoomDisabledMe=true}else{if(a<=this.options.maxZoomLevel&&this._zoomDisabledMe){this.enable()}else{if(this._enabled){this._iteratePiles(this._map.removeLayer,this._map);this._iterateMarkers(this._map.removeLayer,this._map);this._leafpiles={};this._iterateMarkers(this._pileMarker,this)}}}},_onPileClick:function(d){this.fire("leafpileclick",{leafpile:d.target,markers:d.markers,zooming:(d.markers.length>1),cancelZoom:function(){d.cancel=true}});if(d.cancel===true){return}if(d.markers.length>1||this.options.singlePiles){var b=[];for(var a=0;a<d.markers.length;a++){b.push(d.markers[a].getLatLng())}var f=new L.LatLngBounds(b);var c=Math.min(this._map.getBoundsZoom(f),this._map.getZoom()+this.options.maxZoomChange);this._map.setView(f.getCenter(),c)}},_pileMarker:function(g){var a=this._map.latLngToLayerPoint(g.getLatLng()),d=null,c=null;for(var b in this._leafpiles){var e=this._leafpiles[b].inBounds(a);if(e!==false&&(!d||e<c)){d=this._leafpiles[b];c=e}}if(d){d.addMarker(g)}else{d=new L.Leafpile.Marker(g,this._map,{radius:this.options.radius,singlePiles:this.options.singlePiles});var f=L.Util.stamp(d);this._leafpiles[f]=d;this._leafpiles[f].on("click",this._onPileClick,this)}return this},_iterateMarkers:function(c,b){for(var a in this._markers){if(this._markers.hasOwnProperty(a)){c.call(b,this._markers[a])}}},_iteratePiles:function(c,b){for(var a in this._leafpiles){if(this._leafpiles.hasOwnProperty(a)){c.call(b,this._leafpiles[a])}}}});L.Leafpile.Icon=L.Icon.extend({options:{size:null},_sizeOptions:{1:{image:"iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAMAAADzN3VRAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAADNQTFRFAAAA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA/5kA8jf0CQAAABB0Uk5TABAgMEBQYHCAj5+vv8/f7yMagooAAACJSURBVHjapZFJDsMgDEVraKAeCr7/aUsIyMJJNulfWIgnT9+vfxQyYxTO4P6BtCnvgRYWq+6SHmt0wGQIBjA0C6J60UhpT580ct7iAELogLSsoMxyLuOY/zHhC8KdpAuS7vZRuPMAp29tgWHd8ShgXn9tjM9yhhCqubnF5aZ46mEssYhQai2e6wcf9hSNzav/NAAAAABJRU5ErkJggg==",iconSize:new L.Point(25,25),iconAnchor:new L.Point(12,12),popupAnchor:new L.Point(0,-8),shadowSize:null},2:{image:"iVBORw0KGgoAAAANSUhEUgAAADcAAAA3CAMAAACfBSJ0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAVNQTFRFAAAAM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzM8wzL/W2aAAAAHB0Uk5TAAIDBQcICQoLDA0ODxASFBUWFxgZGiAhIiQoLjA2Nzg8PT5AQkRIS0xQUVJUV1heX2BjZGZoaWprbG9wcXJzd3h5fn+AgYKDhIaMkpibnqKmp6irrK2vs7W3ubu9v8HDxcfJy8/T19vf4+fr7/P3+1dhVJMAAAOoSURBVHjavZbrWxJBFIcHhVbJFXJbSdrQNK+USlhaSZAt4AUzrcTUZSEvoZbx/39q5pzZ2WEv+Dx96PcB5nLePXPmcmaIX/1DSZ0KylFWSg71k7sUUUZ0FNjGeWVEifTE4pruKMbqw6KqxcOpKPUlBHZyw0g0ZIhDuqwEa9O7NBQ02L6ka2As5NcLtC21ubo0nXbbk33+WRSRpReLFZOKBjjO/iuF6ZSIsj8MSy9XTdQoITO8uJFNCTAYy1KKa5yQnKiUMkFghGNGoWwKzRNiuqosOqA0OXxKMhuS4U6BPKjV3Hr5PR9r0l1tbJiuODZbe0c/bItMWI3W6eGO0+qAcSc47q3iUPWmxaTl4M8+qXlAHmICY3MGeUAp0ESVF+zjLexakbYEUbBS4M6OGhZXbp/+cHIHY8yireLuwWwZMUo5ou6EmghWDdyqjFNhufm6udj5z3b74swLrklno48GuIzYIefOrjuo27bNwRbEWMnI2zv6CN3VmhjNVcfVnwsOHoNJXu3a2+l3rNFG7HenS1d8bthy5FTvgTBK5l6DYx61ETwxc6PEr9jUIXTfdHw6h44vjyVrLTEcVxIxKA8W2Tx2/Lql7fsz/PP3lbiawEzwkg48N/XM0LSi9asToMt6bnDMWJnKvTLNSUYgV4SpOqJf3T3pBOlmty6WYt7lqu6aX3YChTMDG3zJy7VYVzuYw43ziZmt3sX5Z/Tgv3HyOP9xXl64XEmsg9UKXgfpSCy4XB64z6wvZN2h6xTMMi43Cw3bTSt0n4EO4chDcsIsYWAqOwnb1xd45LeZUUEHTnU3Wug5unLOEdMscgpmJRNkBZ7ba54odmCYaeQieAttYm5vgcX3rjxxVpeiM/M6CNOZyEtf2Uh3q9a5nJeeA9hw8hKTyp8aeopna5p1d8dEHryEbVIdqzuTYi6ju6hI83NlDn4gRcsjbayOwZkfU26ij+In3ji33mDdyxVJGodTeSrcCYepEr8s5+yGh7NVorHe8qJ8r5A+jV9IgMVoPrRt+Wqob9NmCpZ5cJqTeQd0Ds7TyhQk7m+nrSZ11Goc7bF5VOn3XnNMH0DKfU49JOCOa7tWE1cty4H3+G0+LL0LknircXd+lWLCKhnxPCgUKLwN5CpPnM9rEc8DRsHLN5XdKPuotQw1B1ALforCsZrOb8rQxrIhHhER/8tOvutTk/Nrq8VqdX11adbofu6EuQuV0gOL6eEa6eUvmgjDEnRP9iTVIEr1Un8BTudQx/p5D9QAAAAASUVORK5CYII=",iconSize:new L.Point(55,55),iconAnchor:new L.Point(27,27),popupAnchor:new L.Point(0,-14),shadowSize:null},10:{image:"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",iconSize:new L.Point(65,65),iconAnchor:new L.Point(32,32),popupAnchor:new L.Point(0,-18),shadowSize:null},20:{image:"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",iconSize:new L.Point(75,75),iconAnchor:new L.Point(37,37),popupAnchor:new L.Point(0,-22),shadowSize:null}},initialize:function(a){this._setPileOptions(a||1)},update:function(a,b){this._setPileOptions(a);this._setIconStyles(b,a)},createIcon:function(){var a=document.createElement("div");this._setIconStyles(a);return a},createShadow:function(){return null},_setPileOptions:function(b){for(var a in this._sizeOptions){if(b<=a){this.options=this._sizeOptions[a];break}}},_setIconStyles:function(b,a){L.Icon.prototype._setIconStyles.call(this,b,"icon");b.style.cursor="pointer";b.style.background="url(data:image/png;base64,"+this.options.image+") no-repeat 0 0";b.style["text-align"]="center";b.style["font-size"]="12px";b.style["font-weight"]="bold";b.style.color="#fff";b.style["line-height"]=this.options.iconSize.y+"px";b.innerHTML=a}});L.Leafpile.Marker=L.Marker.extend({options:{radius:60,singlePiles:false},initialize:function(d,b,a){L.Util.setOptions(this,a);this.options.icon=new L.Leafpile.Icon(1);this._map=b;var c=L.Util.stamp(d);this._markers={};this._markers[c]=d;d._leafpile=this;L.Util.extend(d,{openPopup:this._openMemberMarkerPopup});this._latlng=d.getLatLng();this._center=this._map.latLngToLayerPoint(this._latlng);if(this.options.singlePiles){this._map.addLayer(this);this.options.icon.update(1,this._icon)}else{this._map.addLayer(d)}},onRemove:function(a){if(!this.options.singlePiles&&this.size()==1){this._map.removeLayer(this.first())}this._removeIcon();if(this.closePopup){this.closePopup()}a.off({viewreset:this.update,zoomanim:this._animateZoom},this)},inBounds:function(a){var b=this._center.distanceTo(a);return(b<this.options.radius?b:false)},addMarker:function(d){if(!this.options.singlePiles&&this.size()==1){this._map.removeLayer(this.first());this._map.addLayer(this)}var c=L.Util.stamp(d);this._markers[c]=d;d._leafpile=this;var b=this.size();this.options.icon.update(b,this._icon);var a=this._map.latLngToLayerPoint(d.getLatLng());this._center=new L.Point((this._center.x*(b-1)+a.x)/b,(this._center.y*(b-1)+a.y)/b);this.setLatLng(this._map.layerPointToLatLng(this._center));L.Util.extend(d,{openPopup:this._openMemberMarkerPopup})},_openMemberMarkerPopup:function(){if(this._popup&&!this._map&&this._leafpile){this._leafpile.bindPopup(this._popup._content);this._leafpile.openPopup();return this}else{return L.Marker.prototype.openPopup.call(this)}},hasMarker:function(b){var a=L.Util.stamp(b);return(this._markers[a]?true:false)},removeMarker:function(b){if(!this.hasMarker(b)){return false}var a=L.Util.stamp(b);delete this._markers[a];delete b._leafpile;if(this.size()==1&&!this.options.singlePiles){this._map.removeLayer(this);this._map.addLayer(this.first())}else{if(this.size()==0){this._map.removeLayer(this);this._map.removeLayer(b)}else{this._resetMapPosition();this.options.icon.update(Object.keys(this._markers).length,this._icon)}}},_resetMapPosition:function(){var d=[0,0];var c=this.size();for(var b in this._markers){var e=this._markers[b];var a=this._map.latLngToLayerPoint(e.getLatLng());d[0]+=(a.x/c);d[1]+=(a.y/c)}this._center=new L.Point(d[0],d[1]);this.setLatLng(this._map.layerPointToLatLng(this._center))},_onMouseClick:function(c){L.DomEvent.stopPropagation(c);var b=[];for(var a in this._markers){b.push(this._markers[a])}this.fire("click",{originalEvent:c,markers:b})},size:function(){var b=0;for(var a in this._markers){if(this._markers.hasOwnProperty(a)){b++}}return b},first:function(){if(this.size()>0){var a=Object.keys(this._markers)[0];return this._markers[a]}return null}});
